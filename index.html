<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SportSphere - Social Sports Platform</title>

    <!-- PWA: Web App Manifest -->
    <link rel="manifest" href="/manifest.json">
    <!-- PWA: Theme Color for browser UI -->
    <meta name="theme-color" content="#06B6D4">

    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK (v8) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

    <!-- React and Babel -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { background-color: #111827; font-family: 'Inter', sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1f2937; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        .custom-scrollbar-nav::-webkit-scrollbar { display: none; }
        .custom-scrollbar-nav { -ms-overflow-style: none; scrollbar-width: none; }
        .toggle { -webkit-appearance: none; -moz-appearance: none; appearance: none; height: 1.5rem; width: 2.75rem; border-radius: 9999px; background-color: #4b5563; position: relative; cursor: pointer; transition: background-color 0.2s ease-in-out; }
        .toggle:checked { background-color: #06B6D4; }
        .toggle::before { content: ""; position: absolute; top: 0.25rem; left: 0.25rem; height: 1rem; width: 1rem; border-radius: 9999px; background-color: white; transition: transform 0.2s ease-in-out; }
        .toggle:checked::before { transform: translateX(1.25rem); }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyCT9bFZUkQ25JUNhW00XnvUWMa1kO9fI0o",
            authDomain: "sportysphere-pwa.firebaseapp.com",
            projectId: "sportysphere-pwa",
            storageBucket: "sportysphere-pwa.appspot.com",
            messagingSenderId: "850598542865",
            appId: "1:850598542865:web:d482a25411733391157bb0",
            measurementId: "G-Q474YZP0BM"
        };

        // --- Initialize Firebase ---
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // --- React Hooks ---
        const { useState, useRef, useEffect, useMemo } = React;

        // --- Data & Configuration ---
        const navigationItems = [
          { id: 'home', label: 'Home', icon: 'üè†' }, { id: 'live', label: 'Live Games', icon: 'üìä' },
          { id: 'moments', label: 'Moments', icon: 'üé•' }, { id: 'betting', label: 'Betting', icon: 'üí∞' },
          { id: 'news', label: 'News', icon: 'üì∞' }, { id: 'shop', label: 'Shop', icon: 'üõí' },
          { id: 'profile', label: 'Profile', icon: 'üë§' },
        ];
        const roleIcons = { Fan: 'üëë', Player: 'üëï', Reporter: 'üìù', Analyst: 'üìà', Team: 'üèüÔ∏è', Sponsor: 'üí≤', Advertiser: 'üè∑Ô∏è', Referee: 'üì£', NewsChannel: 'üì∫', Admin: 'üîë', AIAdmin: 'ü§ñ' };
        const roleColors = { Fan: 'yellow-400', Player: 'blue-500', Reporter: 'orange-500', Analyst: 'red-600', Team: 'purple-600', Sponsor: 'pink-500', Advertiser: 'indigo-500', Referee: 'gray-400', NewsChannel: 'teal-500', Admin: 'gray-200', AIAdmin: 'green-500' };
        const userSelectableRoles = [
            { id: 'Fan', desc: 'Follow teams, players, and share your passion for sports.' },
            { id: 'Player', desc: 'Showcase your skills, stats, and connect with fans.' },
            { id: 'Reporter', desc: 'Share news, interviews, and insights about the sports world.' },
            { id: 'Analyst', desc: 'Provide data-driven insights and predictions.' },
        ];
        
        // --- REALISTIC MOCK DATA ---
        const MOCK_DATA = {
            players: {
                'clatous-chama': { name: 'Clatous Chama', affiliation: 'Simba SC', photo: 'https://img.a.transfermarkt.technology/portrait/header/238960-1698405583.jpg?lm=1', bio: 'Zambian professional footballer who plays as an attacking midfielder for Simba S.C. and the Zambia national team.' },
                'feisal-salum': { name: 'Feisal Salum', affiliation: 'Azam FC', photo: 'https://azamfc.co.tz/wp-content/uploads/2023/07/FEISAL-ABDALLAH-SALUM-1-1-scaled.jpg', bio: 'Tanzanian professional footballer who plays as a midfielder for Azam FC and the Tanzania national team.' },
                'stephane-aziz-ki': { name: 'St√©phane Aziz Ki', affiliation: 'Yanga SC', photo: 'https://www.unafut.com/wp-content/uploads/2022/08/STEPHANE-AZIZ-KI.png', bio: 'Burkinab√© professional footballer who plays as an attacking midfielder for Young Africans S.C. and the Burkina Faso national team.' },
                'lionel-messi': { name: 'Lionel Messi', affiliation: 'Inter Miami CF', photo: 'https://upload.wikimedia.org/wikipedia/commons/b/b4/Lionel-Messi-Argentina-2022-FIFA-World-Cup_%28cropped%29.jpg', bio: 'Argentine professional footballer who plays as a forward for and captains both Major League Soccer club Inter Miami and the Argentina national team.' },
                'cristiano-ronaldo': { name: 'Cristiano Ronaldo', affiliation: 'Al Nassr FC', photo: 'https://upload.wikimedia.org/wikipedia/commons/2/23/Cristiano_Ronaldo_playing_for_Al_Nassr_FC_against_Persepolis%2C_2023-09-19_%28cropped%29.jpg', bio: 'Portuguese professional footballer who plays as a forward for and captains both Saudi Pro League club Al Nassr and the Portugal national team.' },
            },
            teams: {
                'simba-sc': { name: 'Simba SC', logo: 'https://upload.wikimedia.org/wikipedia/en/thumb/4/41/Simba_S.C._logo.svg/1200px-Simba_S.C._logo.svg.png' },
                'yanga-sc': { name: 'Yanga SC', logo: 'https://upload.wikimedia.org/wikipedia/en/thumb/e/e7/Young_Africans_S.C._logo.svg/1200px-Young_Africans_S.C._logo.svg.png' },
                'azam-fc': { name: 'Azam FC', logo: 'https://upload.wikimedia.org/wikipedia/en/thumb/a/a3/Azam_FC.svg/1200px-Azam_FC.svg.png' },
            },
            news: [
                { id: 1, type: 'breaking', category: 'NBC Premier League', title: 'Kariakoo Derby: Simba vs Yanga Ends in a Thrilling Draw!', source: 'Azam TV', time: '1h ago', views: '25.6K' },
                { id: 2, type: 'regular', category: 'La Liga', title: 'Messi Scores Brace in Inter Miami Win', source: 'ESPN', time: '3h ago', views: '102K' },
                { id: 3, type: 'rumor', category: 'Transfers', title: 'Azam FC Eyeing Ugandan Striker for Next Season', source: 'Mwanaspoti', time: '5h ago', views: '12K' },
                { id: 4, type: 'regular', category: 'UCL', title: 'Ronaldo Leads Al Nassr to Victory in Asian Champions League', source: 'Sky Sports', time: '8h ago', views: '88K' },
            ],
            games: [
                { id: 1, league: 'NBC Premier League', team1Name: 'Simba SC', team2Name: 'Yanga SC', score1: 1, score2: 1, time: "FT", status: 'Finished', team1Logo: 'https://upload.wikimedia.org/wikipedia/en/thumb/4/41/Simba_S.C._logo.svg/1200px-Simba_S.C._logo.svg.png', team2Logo: 'https://upload.wikimedia.org/wikipedia/en/thumb/e/e7/Young_Africans_S.C._logo.svg/1200px-Young_Africans_S.C._logo.svg.png' },
                { id: 2, league: 'NBC Premier League', team1Name: 'Azam FC', team2Name: 'Coastal Union', score1: 2, score2: 0, time: "LIVE 82'", status: 'Live', team1Logo: 'https://upload.wikimedia.org/wikipedia/en/thumb/a/a3/Azam_FC.svg/1200px-Azam_FC.svg.png', team2Logo: 'https://upload.wikimedia.org/wikipedia/en/thumb/f/f5/Coastal_Union_logo.svg/1200px-Coastal_Union_logo.svg.png' },
                { id: 3, league: 'La Liga', team1Name: 'Real Madrid', team2Name: 'FC Barcelona', time: "Tomorrow 22:00", status: 'Upcoming', team1Logo: 'https://upload.wikimedia.org/wikipedia/en/thumb/5/56/Real_Madrid_CF.svg/1200px-Real_Madrid_CF.svg.png', team2Logo: 'https://upload.wikimedia.org/wikipedia/en/thumb/4/47/FC_Barcelona_%28crest%29.svg/1200px-FC_Barcelona_%28crest%29.svg.png' },
            ],
            moments: [
                { id: 1, type: 'video', mediaUrl: 'https://storage.googleapis.com/gtv-videos-bucket/sample/ForBiggerFun.mp4', user: 'SimbaHighlights', caption: 'All goals from the Kariakoo Derby! What a match! üî•', likes: '15k', comments: [] },
                { id: 2, type: 'image', mediaUrl: 'https://dailynews.co.tz/wp-content/uploads/2023/04/simba-yanga.jpg', user: 'TanzaniaFootball', caption: 'The atmosphere at the Kariakoo Derby was electric! üáπüáø', likes: '22k', comments: [] },
                { id: 3, type: 'video', mediaUrl: 'https://storage.googleapis.com/gtv-videos-bucket/sample/TearsOfSteel.mp4', user: 'MessiMagic', caption: 'Another incredible free-kick from the GOAT! üêê', likes: '1.2M', comments: [] },
            ]
        };

        // --- Helper Hooks & Functions ---
        const getRoleColorClass = (role) => `text-${roleColors[role] || 'gray-400'} border-${roleColors[role] || 'gray-400'}`;
        function useScrollDirection() {
          const [scrollDirection, setScrollDirection] = useState(null);
          const lastScrollY = useRef(0);
          useEffect(() => {
            const updateScrollDirection = () => {
              const scrollY = window.scrollY;
              const direction = scrollY > lastScrollY.current ? "down" : "up";
              if (direction !== scrollDirection && (Math.abs(scrollY - lastScrollY.current) > 10)) { setScrollDirection(scrollY < 50 ? "up" : direction); }
              lastScrollY.current = scrollY > 0 ? scrollY : 0;
            };
            window.addEventListener("scroll", updateScrollDirection, { passive: true });
            return () => window.removeEventListener("scroll", updateScrollDirection);
          }, [scrollDirection]);
          return scrollDirection;
        }

        // --- General UI Components ---
        const RoleBadge = ({ role, className = '' }) => (<div className={`px-3 py-1 rounded-full text-sm font-semibold border flex items-center justify-center space-x-1.5 ${getRoleColorClass(role)} ${className}`}><span className="text-lg">{roleIcons[role] || '‚ùì'}</span><span>{role === 'NewsChannel' ? 'News Channel' : role}</span></div>);
        const SectionHeader = ({ title }) => <h3 className="text-xl font-semibold text-white mb-4 border-b-2 border-gray-700 pb-2">{title}</h3>;
        const InfoCard = ({ title, children }) => (<div className="mb-8"><SectionHeader title={title} /><div className="bg-gray-800/50 p-4 rounded-lg space-y-3">{children}</div></div>);
        const StatCard = ({ label, value }) => (<div className="bg-gray-800 p-4 rounded-lg text-center shadow-md transform hover:scale-105 transition-transform duration-300"><p className="text-sm text-gray-400">{label}</p><p className="text-2xl font-bold text-white">{value}</p></div>);
        const LoadingSpinner = () => <div className="flex items-center justify-center h-screen bg-gray-900"><div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-cyan-500"></div></div>;

        // --- Profile Components ---
        const ProfileHeader = ({ user, profileData }) => (
            <div className="flex flex-col sm:flex-row justify-between items-center mb-6">
                <div className="flex items-center space-x-6">
                    <img src={profileData.photo || user.photoURL || `https://placehold.co/200x200/1f2937/4b5563?text=${user.displayName?.charAt(0) || 'U'}`} alt={`${user.displayName} profile`} className="w-24 h-24 sm:w-32 sm:h-32 rounded-full border-4 border-gray-600 object-cover" />
                    <div>
                        <h1 className="text-3xl sm:text-4xl font-bold text-white">{profileData.name || user.displayName}</h1>
                        <p className="text-lg text-cyan-400">{profileData.role}</p>
                        {profileData.affiliation && <p className="text-md text-gray-300">{profileData.affiliation}</p>}
                    </div>
                </div>
            </div>
        );

        const PostCreationForm = ({ user, role }) => {
            const [newPost, setNewPost] = useState({ text: '', image: null });
            const [showPostForm, setShowPostForm] = useState(false);
            const [isUploading, setIsUploading] = useState(false);

            const handlePostSubmit = async (e) => {
                e.preventDefault();
                if (!newPost.text.trim()) return;
                setIsUploading(true);
                try {
                    let imageUrl = null;
                    if (newPost.image) {
                        const storageRef = storage.ref(`posts/${user.uid}/${Date.now()}_${newPost.image.name}`);
                        await storageRef.put(newPost.image);
                        imageUrl = await storageRef.getDownloadURL();
                    }
                    await db.collection('posts').add({ userId: user.uid, userName: user.displayName, userPhoto: user.photoURL, role, text: newPost.text, imageUrl, likes: 0, comments: [], timestamp: firebase.firestore.FieldValue.serverTimestamp() });
                    setNewPost({ text: '', image: null });
                    setShowPostForm(false);
                } catch (error) { console.error("Error uploading post:", error); } 
                finally { setIsUploading(false); }
            };

            return (
                <>
                    <button onClick={() => setShowPostForm(!showPostForm)} className="mb-4 px-4 py-2 bg-cyan-500 rounded-lg text-white hover:bg-cyan-600 transition-colors duration-200">{showPostForm ? 'Cancel' : 'Create New Post'}</button>
                    {showPostForm && (
                        <form onSubmit={handlePostSubmit} className="mb-6 bg-gray-700 p-4 rounded-lg">
                            <textarea value={newPost.text} onChange={(e) => setNewPost({...newPost, text: e.target.value})} placeholder="What's on your mind?" className="w-full p-3 rounded-lg bg-gray-800 text-white border border-gray-600 mb-3" rows="3" />
                            <div className="flex items-center justify-between">
                                <div>
                                    <input type="file" id={`post-image-${role}`} accept="image/*" onChange={(e) => setNewPost({...newPost, image: e.target.files[0]})} className="hidden" />
                                    <label htmlFor={`post-image-${role}`} className="cursor-pointer text-gray-300 hover:text-white p-2">
                                        <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fillRule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-4 4 4 4-4V5h-2v5L9 6 4 11V5h12v10z" clipRule="evenodd"></path></svg>
                                    </label>
                                    {newPost.image && <span className="text-sm text-gray-300 ml-2">{newPost.image.name}</span>}
                                </div>
                                <button type="submit" disabled={isUploading || !newPost.text.trim()} className="px-4 py-2 bg-cyan-500 rounded-lg text-white hover:bg-cyan-600 transition-colors duration-200 disabled:opacity-50">{isUploading ? 'Posting...' : 'Post'}</button>
                            </div>
                        </form>
                    )}
                </>
            );
        };
        
        const ProfilePostFeed = ({ userId }) => {
            const [posts, setPosts] = useState([]);
            useEffect(() => {
                const unsubscribe = db.collection('posts').where('userId', '==', userId).orderBy('timestamp', 'desc').onSnapshot(snapshot => setPosts(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }))));
                return () => unsubscribe();
            }, [userId]);
            
            return (<div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">{posts.length > 0 ? posts.map(post => <ProfilePostCard key={post.id} post={post} />) : <p className="text-gray-400 col-span-full">No posts yet.</p>}</div>);
        };
        
        const ProfilePostCard = ({ post }) => (
            <div className="bg-gray-700 rounded-lg overflow-hidden shadow-lg group">
                {post.imageUrl && <img src={post.imageUrl} alt="Post content" className="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300" />}
                <div className="p-4">
                    <p className="text-gray-300 text-sm">{post.text}</p>
                    <div className="flex items-center justify-between mt-2">
                        <span className="text-xs text-gray-500">{new Date(post.timestamp?.toDate()).toLocaleString()}</span>
                        <div className="flex space-x-2">
                            <span className="text-xs text-gray-400">‚ù§Ô∏è {post.likes || 0}</span>
                            <span className="text-xs text-gray-400">üí¨ {post.comments?.length || 0}</span>
                        </div>
                    </div>
                </div>
            </div>
        );

        // --- Role-Specific Profile Components ---
        const FanProfile = ({ user, profileData }) => (
            <>
                <ProfileHeader user={user} profileData={profileData} />
                <p className="text-gray-300 mb-6">{profileData.bio || "Just a passionate sports fan! Living for the game."}</p>
                <InfoCard title="Posts"><PostCreationForm user={user} role={profileData.role} /><ProfilePostFeed userId={user.uid} /></InfoCard>
            </>
        );

        const PlayerProfile = ({ user, profileData }) => (
            <>
                <ProfileHeader user={user} profileData={profileData} />
                <p className="text-gray-300 mb-6">{profileData.bio || "Dedicated athlete striving for greatness."}</p>
                <InfoCard title="Posts"><PostCreationForm user={user} role={profileData.role} /><ProfilePostFeed userId={user.uid} /></InfoCard>
            </>
        );
        
        const ReporterProfile = ({ user, profileData }) => (
            <>
                <ProfileHeader user={user} profileData={profileData} />
                <p className="text-gray-300 mb-6">{profileData.bio || "Lead sports journalist. Bringing you the latest stories from the pitch."}</p>
                <InfoCard title="Posts"><PostCreationForm user={user} role={profileData.role} /><ProfilePostFeed userId={user.uid} /></InfoCard>
            </>
        );
        
        const AnalystProfile = ({ user, profileData }) => (
            <>
                <ProfileHeader user={user} profileData={profileData} />
                <p className="text-gray-300 mb-6">{profileData.bio || "Data-driven sports analyst."}</p>
                <InfoCard title="Posts"><PostCreationForm user={user} role={profileData.role} /><ProfilePostFeed userId={user.uid} /></InfoCard>
            </>
        );

        const AdminProfile = ({ user, profileData }) => {
            const [users, setUsers] = useState([]);
            useEffect(() => {
                const unsubscribe = db.collection('users').onSnapshot(snapshot => setUsers(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }))));
                return () => unsubscribe();
            }, []);

            return (
                <>
                    <ProfileHeader user={user} profileData={profileData} />
                    <InfoCard title="User Management">
                        <div className="overflow-x-auto">
                            <table className="w-full text-gray-300">
                                <thead><tr className="border-b border-gray-700"><th className="text-left p-2">User</th><th className="text-left p-2">Role</th><th className="text-left p-2">Status</th></tr></thead>
                                <tbody>{users.map(u => (<tr key={u.id} className="border-b border-gray-700 hover:bg-gray-700/50"><td className="p-2 flex items-center"><img src={u.photoURL || 'https://placehold.co/100x100/1f2937/4b5563?text=U'} className="w-8 h-8 rounded-full mr-2" /><span>{u.displayName}</span></td><td className="p-2"><RoleBadge role={u.role} className="text-xs" /></td><td className="p-2">{u.banned ? <span className="text-red-400">Banned</span> : <span className="text-green-400">Active</span>}</td></tr>))}</tbody>
                            </table>
                        </div>
                    </InfoCard>
                </>
            );
        };
        
        const RoleSelection = ({ user, onRoleSelected }) => {
            const [isSavingRole, setIsSavingRole] = useState(false);

            const handleRoleSelect = async (newRole) => {
                if (!user || !user.uid) return;
                setIsSavingRole(true);
                try {
                    // Add default data based on role
                    let roleSpecificData = {};
                    const selectedRoleInfo = MOCK_DATA.players[Object.keys(MOCK_DATA.players)[0]]; // Just as an example
                    if(newRole === 'Player') {
                        roleSpecificData = { affiliation: 'Free Agent', bio: 'A rising star in the world of sports.', photo: selectedRoleInfo.photo };
                    } else if (newRole === 'Reporter') {
                        roleSpecificData = { affiliation: 'Independent Journalist', bio: 'Covering the latest stories and breaking news.' };
                    } else if (newRole === 'Analyst') {
                        roleSpecificData = { affiliation: 'Sports Analysis', bio: 'Providing data-driven insights.' };
                    }

                    await db.collection('users').doc(user.uid).update({ role: newRole, roleSelected: true, ...roleSpecificData });
                    onRoleSelected(newRole);
                } catch (error) { console.error("Error updating user role:", error); } 
                finally { setIsSavingRole(false); }
            };

            return (
                <div className="text-center py-10">
                    <h2 className="text-2xl font-bold text-white mb-6">Select Your Role</h2>
                    <p className="text-gray-300 mb-8">Choose how you want to participate in SportSphere</p>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl mx-auto">
                        {userSelectableRoles.map(r => (
                            <button key={r.id} onClick={() => handleRoleSelect(r.id)} disabled={isSavingRole} className="p-6 bg-gray-700 rounded-xl hover:bg-gray-600 transition-colors duration-200 text-left disabled:opacity-50 disabled:cursor-not-allowed">
                                <div className="flex items-center space-x-3 mb-2"><span className="text-2xl">{roleIcons[r.id]}</span><h3 className="text-xl font-bold">{r.id}</h3></div>
                                <p className="text-gray-300 text-sm">{r.desc}</p>
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        const UserProfile = ({ user, onRoleChange }) => {
            const [profileData, setProfileData] = useState(null);
            const [isLoading, setIsLoading] = useState(true);

            useEffect(() => {
                if (!user) return;
                const unsubscribe = db.collection('users').doc(user.uid).onSnapshot(doc => {
                    if (doc.exists) {
                        setProfileData(doc.data());
                    }
                    setIsLoading(false);
                });
                return () => unsubscribe();
            }, [user]);

            const handleRoleSelected = (newRole) => {
                setProfileData(prev => ({ ...prev, role: newRole }));
                onRoleChange(newRole);
            };

            if (isLoading) return <div className="p-8 text-center"><LoadingSpinner /></div>;
            if (!profileData) return <div className="p-8 text-center text-red-400">Could not load user profile.</div>;

            const renderProfileContent = () => {
                if (!profileData.role) {
                    return <RoleSelection user={user} onRoleSelected={handleRoleSelected} />;
                }
                switch (profileData.role) {
                    case 'Player': return <PlayerProfile user={user} profileData={profileData} />;
                    case 'Fan': return <FanProfile user={user} profileData={profileData} />;
                    case 'Reporter': return <ReporterProfile user={user} profileData={profileData} />;
                    case 'Analyst': return <AnalystProfile user={user} profileData={profileData} />;
                    case 'Admin': return <AdminProfile user={user} profileData={profileData} />;
                    default: return <div className="p-8 text-center text-gray-400">Unknown role.</div>;
                }
            };

            return (<div className="p-4 md:p-8"><div className="max-w-6xl mx-auto"><main className="bg-gray-800 rounded-2xl shadow-2xl p-6 sm:p-8">{renderProfileContent()}</main></div></div>);
        };

        // --- Navigation and Main Content Components ---
        const LandingPage = () => {
            const [showLoginOptions, setShowLoginOptions] = useState(false);
            const [isLoggingIn, setIsLoggingIn] = useState(false);
            const handleGoogleLogin = async () => { setIsLoggingIn(true); try { const provider = new firebase.auth.GoogleAuthProvider(); await firebase.auth().signInWithPopup(provider); } catch (error) { console.error("Google Sign-In Error:", error); } finally { setIsLoggingIn(false); } };
            const handleAdminLogin = async () => { setIsLoggingIn(true); try { await firebase.auth().signInWithEmailAndPassword('davidmbazza@gmail.com', 'TEST123'); } catch (error) { console.error("Admin Sign-In Error:", error); } finally { setIsLoggingIn(false); } };
            
            return (
                <div className="relative w-full min-h-screen flex flex-col justify-center items-center text-center p-4 overflow-hidden" style={{ backgroundImage: 'url(https://images.unsplash.com/photo-1579952363873-27f3bade9f55?q=80&w=2970&auto=format&fit=crop)', backgroundSize: 'cover', backgroundPosition: 'center' }}>
                    <div className="absolute inset-0 bg-black bg-opacity-70 backdrop-blur-sm"></div>
                    <div className="relative z-10 text-white max-w-2xl mx-auto flex flex-col items-center">
                        <h1 className="text-4xl md:text-6xl font-extrabold mb-4">Welcome to <br /><span className="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-orange-500">SportSphere</span></h1>
                        <p className="text-lg md:text-xl mb-8 leading-relaxed">The ultimate social platform for sports fans, players, and experts. Connect, share, and experience sports like never before.</p>
                        {!showLoginOptions ? (<button onClick={() => setShowLoginOptions(true)} className="flex items-center justify-center px-8 py-3 bg-cyan-500 rounded-full font-semibold text-lg shadow-lg hover:bg-cyan-600 transition-all duration-300 transform hover:scale-105">Join Community</button>) : (<div className="bg-gray-800/80 rounded-xl p-8 backdrop-blur-sm w-full max-w-sm"><h2 className="text-2xl font-bold mb-6">Sign In</h2><div className="space-y-4"><button onClick={handleGoogleLogin} disabled={isLoggingIn} className="w-full flex items-center justify-center space-x-2 px-6 py-3 bg-white text-gray-800 rounded-full font-semibold hover:bg-gray-200 transition-colors duration-200 disabled:opacity-50"><svg className="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg><span>Continue with Google</span></button></div></div>)}
                    </div>
                    <div className="absolute bottom-4 left-4 z-10"><button onClick={handleAdminLogin} disabled={isLoggingIn} className="h-12 w-12 flex items-center justify-center bg-gray-800/80 text-gray-400 rounded-full font-semibold hover:bg-gray-700 hover:text-white transition-colors duration-200 disabled:opacity-50" title="Admin Login"><svg className="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fillRule="evenodd" d="M18 8a6 6 0 01-7.743 5.743L4.257 19.743A1 1 0 012.843 18.33l6.002-6.001A6.002 6.002 0 0118 8zm-6 3a4 4 0 100-8 4 4 0 000 8z" clipRule="evenodd"></path></svg></button></div>
                </div>
            );
        };
        
        const TopNavigationBar = ({ scrollDirection, onSettingsClick, user }) => (
          <header className={`fixed top-0 left-0 right-0 bg-gray-900 bg-opacity-90 backdrop-blur-sm z-40 p-4 flex justify-between items-center border-b border-gray-700 md:pl-20 transition-transform duration-300 ${scrollDirection === 'down' ? '-translate-y-full' : 'translate-y-0'}`}>
            <div className="flex items-center space-x-2 md:hidden"><svg className="w-8 h-8 text-cyan-500" fill="currentColor" viewBox="0 0 20 20"><path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd"></path></svg><span className="text-2xl font-extrabold text-cyan-500">SportSphere</span></div>
            <div className="hidden md:flex items-center space-x-4"><input type="text" placeholder="Search SportSphere..." className="bg-gray-800 border border-gray-700 rounded-full px-4 py-1.5 text-sm w-72 focus:outline-none focus:ring-2 focus:ring-cyan-500" /></div>
            <div className="flex items-center space-x-2 sm:space-x-4">
              <button className="text-gray-400 hover:text-white p-2 rounded-full"><svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg></button>
              <button onClick={onSettingsClick} className="text-gray-400 hover:text-white p-2 rounded-full"><svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></button>
              {user && <img src={user.photoURL || `https://placehold.co/40x40/1f2937/4b5563?text=${user.displayName?.charAt(0) || 'U'}`} className="w-8 h-8 rounded-full" alt="User avatar" />}
            </div>
          </header>
        );

        const DesktopSidebar = ({ activeTab, setActiveTab }) => (
            <aside className="hidden md:flex fixed top-0 left-0 h-full w-20 bg-gray-900 border-r border-gray-800 flex-col items-center py-6 space-y-4 z-50">
                <div className="text-3xl font-bold text-cyan-500">S</div>
                <nav className="flex flex-col items-center space-y-2 mt-8">
                    {navigationItems.map(item => (<button key={item.id} onClick={() => setActiveTab(item.id)} className={`p-3 rounded-lg transition-colors duration-200 ${activeTab === item.id ? 'bg-cyan-500 text-white' : 'text-gray-400 hover:bg-gray-700 hover:text-white'}`} title={item.label}><span className="text-2xl">{item.icon}</span></button>))}
                </nav>
            </aside>
        );

        const BottomTabNavigation = ({ activeTab, setActiveTab, scrollDirection }) => (
            <nav className={`md:hidden fixed bottom-0 left-0 right-0 bg-gray-900 bg-opacity-90 backdrop-blur-sm border-t border-gray-700 flex justify-around p-2 z-40 transition-transform duration-300 ${scrollDirection === 'down' ? 'translate-y-full' : 'translate-y-0'}`}>
                {navigationItems.map(item => (<button key={item.id} onClick={() => setActiveTab(item.id)} className={`flex flex-col items-center space-y-1 p-2 rounded-lg transition-colors duration-200 ${activeTab === item.id ? 'text-cyan-400' : 'text-gray-400 hover:text-white'}`} title={item.label}><span className="text-2xl">{item.icon}</span><span className="text-xs">{item.label}</span></button>))}
            </nav>
        );
        
        const SettingsModal = ({ isOpen, onClose, onSignOut }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50" onClick={onClose}>
                    <div className="bg-gray-800 rounded-2xl shadow-2xl p-6 w-full max-w-md mx-4" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center mb-6"><h2 className="text-2xl font-bold text-white">Settings</h2><button onClick={onClose} className="text-gray-400 hover:text-white">&times;</button></div>
                        <div className="space-y-4"><div className="flex justify-between items-center p-3 bg-gray-700/50 rounded-lg"><label htmlFor="dark-mode" className="text-gray-200">Dark Mode</label><input type="checkbox" id="dark-mode" className="toggle" defaultChecked /></div><div className="flex justify-between items-center p-3 bg-gray-700/50 rounded-lg"><label htmlFor="notifications" className="text-gray-200">Push Notifications</label><input type="checkbox" id="notifications" className="toggle" /></div><button onClick={onSignOut} className="w-full mt-4 px-4 py-2 bg-red-600 rounded-lg text-white hover:bg-red-700 transition-colors duration-200">Sign Out</button></div>
                    </div>
                </div>
            );
        };
        
        // --- Main Section Components ---
        const HomeSection = ({ role }) => {
            const feedItems = useMemo(() => [
                { type: 'game', ...MOCK_DATA.games[1] },
                { type: 'news', ...MOCK_DATA.news[0] },
                { type: 'post', user: MOCK_DATA.players['lionel-messi'], text: 'Great team win today! On to the next one. üí™ #InterMiamiCF', imageUrl: 'https://assets.goal.com/images/v3/blt26948b49a2b536a0/GOAL_-_Blank_WEB_-_Facebook_-_2024-05-19T093347.469.jpg?auto=webp&format=pjpg&width=1080&quality=60' },
                { type: 'news', ...MOCK_DATA.news[1] },
                { type: 'post', user: MOCK_DATA.players['clatous-chama'], text: 'Tough match but we fought hard. Thanks to the fans for the amazing support! #NguvuMoja', imageUrl: 'https://images.mwananchi.co.tz/mbwana-samatta-na-clatous-chama-1690103774-1500x998.jpg' },
            ], []);

            return (
                <div className="p-4 md:p-8 text-white">
                    <div className="max-w-2xl mx-auto">
                        <h1 className="text-3xl font-bold mb-6">Home Feed</h1>
                        <div className="space-y-6">
                            {feedItems.map((item, index) => {
                                if (item.type === 'game') return <LiveGameCard key={`feed-${index}`} game={item} />;
                                if (item.type === 'news') return <NewsArticleCard key={`feed-${index}`} article={item} />;
                                if (item.type === 'post') return <FeedPostCard key={`feed-${index}`} post={item} />;
                                return null;
                            })}
                        </div>
                    </div>
                </div>
            );
        };
        
        const LiveGameCard = ({ game }) => (
          <div className="bg-gray-800 rounded-xl shadow-lg p-4 border border-gray-700">
            <div className="flex justify-between items-center mb-4">
              <span className="text-sm font-semibold text-gray-300">{game.league}</span>
              <span className={`px-2 py-1 text-white text-xs font-bold rounded-md ${game.status === 'Live' ? 'bg-red-600' : 'bg-gray-600'}`}>{game.status}</span>
            </div>
            <div className="space-y-3">
              <div className="flex justify-between items-center"><div className="flex items-center space-x-3"><img src={game.team1Logo} className="w-8 h-8 object-contain" /><span className="font-semibold text-white text-lg">{game.team1Name}</span></div><span className="font-bold text-2xl text-white">{game.score1}</span></div>
              <div className="flex justify-between items-center"><div className="flex items-center space-x-3"><img src={game.team2Logo} className="w-8 h-8 object-contain" /><span className="font-semibold text-white text-lg">{game.team2Name}</span></div><span className="font-bold text-2xl text-white">{game.score2}</span></div>
            </div>
            <div className="text-center text-sm text-gray-400 mt-3">{game.time}</div>
          </div>
        );

        const NewsArticleCard = ({ article }) => (
          <div className="bg-gray-800 rounded-xl shadow-lg p-4 border border-gray-700">
            <div className="flex items-center space-x-2 mb-2"><span className={`px-2 py-0.5 text-white text-xs font-bold rounded-md ${article.type === 'breaking' ? 'bg-red-600' : 'bg-gray-700'}`}>{article.category}</span></div>
            <h3 className="text-lg font-bold mb-1 text-white">{article.title}</h3>
            <p className="text-sm text-gray-400">{article.source} ¬∑ {article.time}</p>
          </div>
        );

        const FeedPostCard = ({ post }) => (
            <div className="bg-gray-800 rounded-xl shadow-lg p-4 border border-gray-700">
                <div className="flex items-center space-x-3 mb-3">
                    <img src={post.user.photo} className="w-10 h-10 rounded-full object-cover" />
                    <div>
                        <p className="font-semibold text-white">{post.user.name}</p>
                        <p className="text-xs text-gray-400">{post.user.affiliation}</p>
                    </div>
                </div>
                <p className="text-gray-300 text-sm mb-3">{post.text}</p>
                {post.imageUrl && <img src={post.imageUrl} className="w-full h-auto object-cover rounded-lg" />}
            </div>
        );

        const LiveGames = () => (
            <div className="p-4 md:p-8 text-white"><h1 className="text-3xl font-bold mb-6">Fixtures & Live Scores</h1><div className="space-y-4">{MOCK_DATA.games.map(game => <LiveGameCard key={game.id} game={game} />)}</div></div>
        );
        const MomentsSection = () => (
            <div className="p-4 md:p-8 text-white"><h1 className="text-3xl font-bold mb-6">Moments</h1><div className="grid grid-cols-2 md:grid-cols-4 gap-4">{MOCK_DATA.moments.map(moment => <div key={moment.id} className="bg-gray-800 rounded-lg aspect-w-9 aspect-h-16 flex items-center justify-center overflow-hidden"><img src={moment.mediaUrl} className="w-full h-full object-cover" /></div>)}</div></div>
        );
        const BettingSection = () => (<div className="p-4 md:p-8 text-white"><h1 className="text-3xl font-bold mb-6">Betting</h1><p className="text-gray-400">Betting features coming soon.</p></div>);
        const NewsSection = () => (
            <div className="p-4 md:p-8 text-white"><h1 className="text-3xl font-bold mb-6">News Feed</h1><div className="space-y-4">{MOCK_DATA.news.map(article => <NewsArticleCard key={article.id} article={article} />)}</div></div>
        );
        const ShopSection = () => (<div className="p-4 md:p-8 text-white"><h1 className="text-3xl font-bold mb-6">Shop</h1><p className="text-gray-400">Shop features coming soon.</p></div>);

        // --- Main App Component ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('home');
            const [showSettings, setShowSettings] = useState(false);
            const [user, setUser] = useState(null);
            const [userRole, setUserRole] = useState(null);
            const [isLoadingUser, setIsLoadingUser] = useState(true);
            const scrollDirection = useScrollDirection();

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged(async (firebaseUser) => {
                    if (firebaseUser) {
                        const userDocRef = db.collection('users').doc(firebaseUser.uid);
                        const userDoc = await userDocRef.get();
                        if (userDoc.exists) {
                            setUserRole(userDoc.data().role || null);
                        } else {
                             const isInitialAdmin = firebaseUser.email === 'davidmbazza@gmail.com';
                             const newUser = { uid: firebaseUser.uid, displayName: firebaseUser.displayName || 'New User', email: firebaseUser.email, photoURL: firebaseUser.photoURL, role: isInitialAdmin ? 'Admin' : null, roleSelected: isInitialAdmin, createdAt: firebase.firestore.FieldValue.serverTimestamp() };
                            await userDocRef.set(newUser, { merge: true });
                            setUserRole(newUser.role);
                        }
                        setUser(firebaseUser);
                    } else {
                        setUser(null);
                        setUserRole(null);
                    }
                    setIsLoadingUser(false);
                });
                return () => unsubscribe();
            }, []);

            const handleSignOut = async () => { try { await auth.signOut(); setShowSettings(false); } catch (error) { console.error("Error signing out:", error); } };

            if (isLoadingUser) return <LoadingSpinner />;
            if (!user) return <LandingPage />;

            return (
                <div className="min-h-screen bg-gray-900 text-white pb-20 md:pb-0 md:pl-20">
                    <TopNavigationBar scrollDirection={scrollDirection} onSettingsClick={() => setShowSettings(true)} user={user} />
                    <DesktopSidebar activeTab={activeTab} setActiveTab={setActiveTab} />
                    <BottomTabNavigation activeTab={activeTab} setActiveTab={setActiveTab} scrollDirection={scrollDirection} />
                    <main className="pt-20">
                        {activeTab === 'home' && <HomeSection role={userRole} />}
                        {activeTab === 'live' && <LiveGames />}
                        {activeTab === 'moments' && <MomentsSection />}
                        {activeTab === 'betting' && <BettingSection />}
                        {activeTab === 'news' && <NewsSection />}
                        {activeTab === 'shop' && <ShopSection />}
                        {activeTab === 'profile' && <UserProfile user={user} onRoleChange={setUserRole} />}
                    </main>
                    <SettingsModal isOpen={showSettings} onClose={() => setShowSettings(false)} onSignOut={handleSignOut} />
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
