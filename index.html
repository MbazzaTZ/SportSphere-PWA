<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SportSphere - Social Sports Platform</title>

    <!-- Tailwind & React Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #111827; /* gray-900 */
            font-family: 'Inter', sans-serif;
        }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1f2937; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }

        /* Animation Keyframes */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .fade-in { animation: fadeIn 1s ease-out forwards; }
        .slide-up-1 { animation: slideUp 0.8s ease-out 0.5s forwards; opacity: 0; }
        .slide-up-2 { animation: slideUp 0.8s ease-out 1.0s forwards; opacity: 0; }
        .slide-up-3 { animation: slideUp 0.8s ease-out 1.5s forwards; opacity: 0; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- React Hooks ---
        const { useState, useEffect, useMemo } = React;

        // --- Firebase Initialization ---
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        // --- MOCK DATA FOR DEMO PURPOSES ---
        const mockData = {
            posts: Array.from({ length: 20 }, (_, i) => ({
                id: `post_${i}`,
                user: { name: `User ${i+1}`, avatar: `https://placehold.co/48x48/1f2937/ffffff?text=U${i+1}` },
                content: { text: `This is a sample post to demonstrate the feed. Welcome to SportSphere! #SampleData` },
                stats: { likes: Math.floor(Math.random() * 100), comments: Math.floor(Math.random() * 20) }
            }))
        };

        // --- NEW ANIMATED LANDING PAGE ---
        const AnimatedLandingPage = ({ onJoinCommunity }) => (
            <div className="relative w-full min-h-screen flex flex-col justify-center items-center text-center p-4 overflow-hidden" style={{ backgroundImage: 'url(https://placehold.co/1920x1080/000000/fff?text=SportSphere+Stadium)', backgroundSize: 'cover', backgroundPosition: 'center' }}>
                <div className="absolute inset-0 bg-black bg-opacity-70 backdrop-blur-sm"></div>
                <div className="relative z-10 text-white max-w-2xl mx-auto">
                    <h1 className="text-4xl md:text-6xl font-extrabold mb-4 fade-in">
                        Welcome to <br />
                        <span className="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-orange-500">SportSphere</span>
                    </h1>
                    <p className="text-lg md:text-xl mb-8 leading-relaxed slide-up-1">
                        The ultimate social platform for sports fans, players, and experts. Connect, share, and experience sports like never before.
                    </p>
                    <div className="flex justify-center items-center slide-up-2">
                        <button onClick={onJoinCommunity} className="px-8 py-3 bg-cyan-500 rounded-full font-semibold text-lg shadow-lg hover:bg-cyan-600 transition-all duration-300 transform hover:scale-105">
                            Join Community
                        </button>
                    </div>
                </div>
            </div>
        );
        
        // --- AUTHENTICATION PAGE ---
        const AuthPage = ({ onAuthSuccess }) => {
            const [isLoginView, setIsLoginView] = useState(false);
            const [authMethod, setAuthMethod] = useState('email');
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [phoneNumber, setPhoneNumber] = useState('');
            const [otp, setOtp] = useState('');
            const [selectedRole, setSelectedRole] = useState('Fan');
            const [error, setError] = useState('');
            const [showOtpInput, setShowOtpInput] = useState(false);
            const [confirmationResult, setConfirmationResult] = useState(null);

            const roles = ['Fan', 'Player', 'Reporter', 'Analyst', 'Team', 'Sponsor'];
            const auth = firebase.auth();
            const db = firebase.firestore();

            useEffect(() => {
                window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
                    'size': 'invisible',
                    'callback': (response) => {}
                });
            }, []);

            const handleGoogleSignIn = async () => {
                const provider = new firebase.auth.GoogleAuthProvider();
                try {
                    const result = await auth.signInWithPopup(provider);
                    const user = result.user;
                    if (result.additionalUserInfo.isNewUser) {
                        await db.collection("profiles").doc(user.uid).set({
                            email: user.email,
                            name: user.displayName,
                            role: 'Fan',
                            avatar: user.photoURL || `https://placehold.co/128x128/34D399/FFFFFF?text=${user.displayName.charAt(0)}`,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        });
                    }
                    onAuthSuccess();
                } catch (err) {
                    setError(err.message);
                }
            };

            const handlePhoneSubmit = async (e) => {
                e.preventDefault();
                setError('');
                const appVerifier = window.recaptchaVerifier;
                try {
                    const result = await auth.signInWithPhoneNumber(phoneNumber, appVerifier);
                    setConfirmationResult(result);
                    setShowOtpInput(true);
                    setError('OTP has been sent to your phone.');
                } catch (err) {
                    setError(err.message);
                    window.recaptchaVerifier.render().then(widgetId => grecaptcha.reset(widgetId));
                }
            };

            const handleOtpSubmit = async (e) => {
                e.preventDefault();
                setError('');
                try {
                    const result = await confirmationResult.confirm(otp);
                    const user = result.user;
                    const profileDoc = await db.collection('profiles').doc(user.uid).get();
                    if (!profileDoc.exists) {
                         await db.collection("profiles").doc(user.uid).set({
                            phoneNumber: user.phoneNumber,
                            role: 'Fan',
                            name: `User_${user.uid.substring(0,6)}`,
                            avatar: `https://placehold.co/128x128/818CF8/FFFFFF?text=U`,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        });
                    }
                    onAuthSuccess();
                } catch (err) {
                    setError(err.message);
                }
            };

            const handleEmailSubmit = async (e) => {
                e.preventDefault();
                setError('');
                if (isLoginView) {
                    try {
                        await auth.signInWithEmailAndPassword(email, password);
                        onAuthSuccess();
                    } catch (err) {
                        setError(err.message);
                    }
                } else {
                    try {
                        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                        const user = userCredential.user;
                        await user.sendEmailVerification();
                        setError("Registration successful! A verification link has been sent to your email.");
                        await db.collection("profiles").doc(user.uid).set({
                            email: user.email,
                            role: selectedRole,
                            name: email.split('@')[0],
                            avatar: `https://placehold.co/128x128/FBBF24/FFFFFF?text=${email.charAt(0).toUpperCase()}`,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        });
                    } catch (err) {
                        setError(err.message);
                    }
                }
            };

            return (
                <div className="relative w-full min-h-screen flex flex-col justify-center items-center text-center p-4" style={{ backgroundImage: 'url(https://placehold.co/1920x1080/000000/fff?text=SportSphere+Stadium)', backgroundSize: 'cover', backgroundPosition: 'center' }}>
                    <div id="recaptcha-container"></div>
                    <div className="absolute inset-0 bg-black bg-opacity-70 backdrop-blur-md"></div>
                    <div className="relative z-10 text-white max-w-md mx-auto w-full bg-gray-900 bg-opacity-50 p-8 rounded-2xl shadow-lg">
                        <h1 className="text-4xl font-extrabold mb-4">{isLoginView ? 'Welcome Back' : 'Join SportSphere'}</h1>
                        <button onClick={handleGoogleSignIn} className="w-full mb-4 py-3 bg-white text-gray-800 font-semibold rounded-lg flex items-center justify-center space-x-2 hover:bg-gray-200 transition-colors">
                            <svg className="w-6 h-6" viewBox="0 0 48 48"><path fill="#4285F4" d="M24 9.5c3.9 0 6.8 1.6 8.4 3.1l6.3-6.3C34.9 2.6 30 .5 24 .5 14.9.5 7.7 6.4 4.9 14.5l7.6 5.9c1.3-4 5.1-7 9.5-7z"></path><path fill="#34A853" d="M46.2 25.4c0-1.7-.2-3.4-.5-5H24v9.3h12.4c-.5 3-2.1 5.6-4.6 7.3l7.6 5.9c4.4-4.1 7-10 7-17.5z"></path><path fill="#FBBC05" d="M12.5 29.8c-.5-1.5-.8-3.1-.8-4.8s.3-3.3.8-4.8l-7.6-5.9C3.1 18.5 2 21.2 2 24s1.1 5.5 3.9 8.2l7.6-5.9z"></path><path fill="#EA4335" d="M24 47.5c6 0 11.1-2 14.8-5.4l-7.6-5.9c-2 1.3-4.5 2.1-7.2 2.1-4.4 0-8.2-3-9.5-7L4.9 33.5C7.7 41.6 14.9 47.5 24 47.5z"></path><path fill="none" d="M0 0h48v48H0z"></path></svg>
                            <span>Sign in with Google</span>
                        </button>
                        <div className="flex items-center my-4"><hr className="flex-grow border-gray-600"/><span className="mx-2 text-gray-400">OR</span><hr className="flex-grow border-gray-600"/></div>
                        {!showOtpInput && (<div className="flex justify-center bg-gray-700 rounded-lg p-1 mb-4"><button onClick={() => setAuthMethod('email')} className={`w-1/2 py-2 rounded-md ${authMethod === 'email' ? 'bg-cyan-500' : ''}`}>Email</button><button onClick={() => setAuthMethod('phone')} className={`w-1/2 py-2 rounded-md ${authMethod === 'phone' ? 'bg-cyan-500' : ''}`}>Phone</button></div>)}
                        {authMethod === 'email' && !showOtpInput && (<form onSubmit={handleEmailSubmit} className="space-y-4"><input type="email" placeholder="Email Address" value={email} onChange={(e) => setEmail(e.target.value)} className="w-full p-3 rounded-lg bg-gray-700" required/><input type="password" placeholder="Password" value={password} onChange={(e) => setPassword(e.target.value)} className="w-full p-3 rounded-lg bg-gray-700" required/>{!isLoginView && (<select value={selectedRole} onChange={(e) => setSelectedRole(e.target.value)} className="w-full p-3 rounded-lg bg-gray-700"><option disabled>Choose Role</option>{roles.map(r => <option key={r} value={r}>{r}</option>)}</select>)}<button type="submit" className="w-full py-3 bg-cyan-600 rounded-lg font-semibold hover:bg-cyan-700">{isLoginView ? 'Log In' : 'Register with Email'}</button></form>)}
                        {authMethod === 'phone' && !showOtpInput && (<form onSubmit={handlePhoneSubmit} className="space-y-4"><input type="tel" placeholder="+1 555-555-5555" value={phoneNumber} onChange={(e) => setPhoneNumber(e.target.value)} className="w-full p-3 rounded-lg bg-gray-700" required/><button type="submit" className="w-full py-3 bg-cyan-600 rounded-lg font-semibold hover:bg-cyan-700">Send OTP</button></form>)}
                        {showOtpInput && (<form onSubmit={handleOtpSubmit} className="space-y-4"><p className="text-sm text-gray-300">Enter the OTP sent to {phoneNumber}</p><input type="text" placeholder="6-digit OTP" value={otp} onChange={(e) => setOtp(e.target.value)} className="w-full p-3 rounded-lg bg-gray-700" required/><button type="submit" className="w-full py-3 bg-cyan-600 rounded-lg font-semibold hover:bg-cyan-700">Verify & Sign In</button></form>)}
                        {error && <p className="text-red-400 mt-4">{error}</p>}
                        <p className="mt-6">{isLoginView ? "Don't have an account? " : "Already have an account? "}<button onClick={() => { setIsLoginView(!isLoginView); setError('') }} className="font-semibold text-cyan-400 hover:underline">{isLoginView ? 'Register' : 'Log In'}</button></p>
                    </div>
                </div>
            );
        };

        // --- ROLE-BASED PROFILE COMPONENTS ---
        const ProfileHeader = ({ data }) => (
            <div className="flex flex-col sm:flex-row items-center text-center sm:text-left mb-6">
                <img src={data.avatar} alt={`${data.name} profile`} className="w-32 h-32 rounded-full border-4 border-cyan-500 mb-4 sm:mb-0 sm:mr-8" onError={(e) => { e.target.onerror = null; e.target.src='https://placehold.co/128x128/1f2937/4b5563?text=A'; }} />
                <div className="flex-grow">
                    <h1 className="text-4xl font-extrabold text-white">{data.name}</h1>
                    <p className="text-lg text-cyan-400 mt-1">{data.role}</p>
                    <p className="text-gray-400 mt-3">{data.bio || "No bio available."}</p>
                </div>
            </div>
        );

        const FanProfile = ({ data }) => (
            <div>
                <ProfileHeader data={data} />
                <div className="mt-6 border-t border-gray-700 pt-6">
                     <h3 className="text-xl font-bold text-white mb-4">Activity</h3>
                     <p className="text-gray-500">Your recent posts and interactions will appear here.</p>
                </div>
            </div>
        );

        const PlayerProfile = ({ data }) => (
             <div>
                <ProfileHeader data={data} />
                <div className="mt-6 border-t border-gray-700 pt-6 grid md:grid-cols-2 gap-8">
                    <div>
                        <h3 className="text-xl font-bold text-white mb-4">Career Stats</h3>
                        <div className="space-y-2 text-gray-300">
                           {data.careerStats ? data.careerStats.map(stat => <p key={stat.label}><strong className="font-semibold text-white">{stat.label}:</strong> {stat.value}</p>) : <p>No stats available.</p>}
                        </div>
                    </div>
                    <div>
                        <h3 className="text-xl font-bold text-white mb-4">Achievements</h3>
                        <ul className="list-disc list-inside space-y-2 text-gray-300">
                            {data.achievements ? data.achievements.map(ach => <li key={ach}>{ach}</li>) : <li>No achievements listed.</li>}
                        </ul>
                    </div>
                </div>
            </div>
        );
        
        const TeamProfile = ({ data }) => (
            <div>
                <ProfileHeader data={data} />
                 <div className="mt-6 border-t border-gray-700 pt-6">
                     <h3 className="text-xl font-bold text-white mb-4">Team Roster</h3>
                     <p className="text-gray-500">Player roster will be displayed here.</p>
                </div>
            </div>
        );

        const DefaultProfile = ({ data }) => (
            <div>
                <ProfileHeader data={data} />
                <div className="mt-6 border-t border-gray-700 pt-6">
                    <p className="text-gray-500">This is a profile for a {data.role}. More specific details will be shown here.</p>
                </div>
            </div>
        );
        
        // --- HOME FEED COMPONENT (using mock data) ---
        const HomeSection = () => {
             return (
                <div className="p-4 md:p-8">
                    <div className="max-w-2xl mx-auto">
                         <h2 className="text-3xl font-bold text-white mb-6">Home Feed</h2>
                         <div className="space-y-4">
                            {mockData.posts.map(post => (
                                <div key={post.id} className="bg-gray-800 rounded-xl p-4 border border-gray-700 relative">
                                    <span className="absolute top-2 right-2 text-xs bg-yellow-500 text-black font-bold px-2 py-1 rounded-full">Sample</span>
                                    <div className="flex items-start space-x-4">
                                        <img src={post.user.avatar} className="w-12 h-12 rounded-full" />
                                        <div className="flex-grow">
                                            <p className="font-semibold text-white">{post.user.name}</p>
                                            <p className="text-gray-300 mt-1">{post.content.text}</p>
                                            <div className="flex space-x-4 text-gray-500 mt-2">
                                                <span>❤️ {post.stats.likes}</span>
                                                <span>💬 {post.stats.comments}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ))}
                         </div>
                    </div>
                </div>
             );
        };

        // --- MAIN APP ---
        function App() {
            const [user, setUser] = useState(null);
            const [profileData, setProfileData] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            const [activeTab, setActiveTab] = useState('home');
            // New state to manage the app's flow
            const [appState, setAppState] = useState('landing'); // 'landing', 'auth', 'mainApp'

            useEffect(() => {
                const unsubscribe = firebase.auth().onAuthStateChanged(async (user) => {
                    if (user) {
                        setUser(user);
                        const profileRef = firebase.firestore().collection('profiles').doc(user.uid);
                        const doc = await profileRef.get();
                        if (doc.exists) {
                            setProfileData(doc.data());
                        } else {
                            console.log("No profile found for user, creating default.");
                            const defaultData = {
                                email: user.email || '',
                                name: user.displayName || `User_${user.uid.substring(0,6)}`,
                                role: 'Fan',
                                avatar: user.photoURL || `https://placehold.co/128x128/34D399/FFFFFF?text=U`,
                                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            };
                            await profileRef.set(defaultData);
                            setProfileData(defaultData);
                        }
                        setAppState('mainApp'); // User is logged in, go to main app
                    } else {
                        setUser(null);
                        setProfileData(null);
                        // If no user, stay on landing/auth page, don't auto-switch
                    }
                    setIsLoading(false);
                });
                return () => unsubscribe();
            }, []);

            const handleLogout = () => {
                firebase.auth().signOut().then(() => {
                    setAppState('landing'); // Go back to landing page on logout
                });
            };

            const renderProfilePage = () => {
                if (!profileData) return <div className="text-center p-8">Loading profile...</div>;
                switch(profileData.role) {
                    case 'Fan': return <FanProfile data={profileData} />;
                    case 'Player': return <PlayerProfile data={profileData} />;
                    case 'Team': return <TeamProfile data={profileData} />;
                    default: return <DefaultProfile data={profileData} />;
                }
            };

            const renderContent = () => {
                switch (activeTab) {
                    case 'home': return <HomeSection />;
                    case 'profile': return renderProfilePage();
                    case 'live': return <div className="p-8 text-center"><h1 className="text-2xl">Live Games (Sample)</h1></div>;
                    case 'moments': return <div className="p-8 text-center"><h1 className="text-2xl">Moments (Sample)</h1></div>;
                    default: return <HomeSection />;
                }
            };

            if (isLoading) {
                return <div className="min-h-screen flex items-center justify-center text-white">Loading...</div>;
            }

            // Conditional rendering based on appState
            if (appState === 'landing') {
                return <AnimatedLandingPage onJoinCommunity={() => setAppState('auth')} />;
            }

            if (appState === 'auth') {
                return <AuthPage onAuthSuccess={() => setAppState('mainApp')} />;
            }
            
            return (
                <div className="font-sans antialiased bg-gray-900 text-white min-h-screen">
                    <header className="bg-gray-800 p-4 flex justify-between items-center sticky top-0 z-50 border-b border-gray-700">
                        <h1 className="text-xl font-bold text-cyan-400">SportSphere</h1>
                        <nav className="flex items-center space-x-2 md:space-x-4">
                           <button onClick={() => setActiveTab('home')} className={`px-3 py-2 rounded-md text-sm font-medium ${activeTab === 'home' ? 'bg-cyan-500 text-white' : 'text-gray-300 hover:bg-gray-700'}`}>Home</button>
                           <button onClick={() => setActiveTab('live')} className={`px-3 py-2 rounded-md text-sm font-medium ${activeTab === 'live' ? 'bg-cyan-500 text-white' : 'text-gray-300 hover:bg-gray-700'}`}>Live</button>
                           <button onClick={() => setActiveTab('moments')} className={`px-3 py-2 rounded-md text-sm font-medium ${activeTab === 'moments' ? 'bg-cyan-500 text-white' : 'text-gray-300 hover:bg-gray-700'}`}>Moments</button>
                           <button onClick={() => setActiveTab('profile')} className={`px-3 py-2 rounded-md text-sm font-medium ${activeTab === 'profile' ? 'bg-cyan-500 text-white' : 'text-gray-300 hover:bg-gray-700'}`}>Profile</button>
                           <button onClick={handleLogout} className="bg-red-600 hover:bg-red-700 px-3 py-2 rounded-md text-sm font-medium">Logout</button>
                        </nav>
                    </header>
                    <main className="p-4">
                        {renderContent()}
                    </main>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
